{
  "hash": "4bd5bd1ace2fa7db250382011626ef8f",
  "result": {
    "markdown": "---\ntitle: \"Wrangling\"\noutput: html_document\n---\n\n\n***This exercise is the first in the series on evaluating influenza data. This page will wrangle/clean the raw data.***\n\nThis code script uses the data from this paper: McKay, Brian et al. (2020), Virulence-mediated infectiousness and activity trade-offs and their impact on transmission potential of patients infected with influenza, Dryad, Dataset, https://doi.org/10.5061/dryad.51c59zw4v. The raw data has been placed in the `data` file of this repository.\n\n\n## Load packages\n\n::: {.cell}\n\n```{.r .cell-code}\n# | output: false\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2 ──\n✔ ggplot2 3.4.0      ✔ purrr   1.0.1 \n✔ tibble  3.1.8      ✔ dplyr   1.0.10\n✔ tidyr   1.2.1      ✔ stringr 1.5.0 \n✔ readr   2.1.3      ✔ forcats 0.5.2 \n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'ggplot2' was built under R version 4.2.2\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'tidyr' was built under R version 4.2.2\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'readr' was built under R version 4.2.2\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'purrr' was built under R version 4.2.2\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'dplyr' was built under R version 4.2.2\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'stringr' was built under R version 4.2.2\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\n```\n:::\n\n```{.r .cell-code}\nlibrary(readr) # for reading in files\nlibrary(here) # setting directory\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'here' was built under R version 4.2.2\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nhere() starts at C:/Users/Sara/Documents/Documents/Current Classes/MADA/sarabenist-MADA-portfolio\n```\n:::\n\n```{.r .cell-code}\nlibrary(naniar) # for finding missing data\n```\n:::\n\n\n## Load data\n\nFirst, we will load the raw data.\n\n::: {.cell}\n\n```{.r .cell-code}\n#load data from data folder\ndata <- readRDS(here(\"fluanalysis/data/SympAct_Any_Pos.rda\"))\n```\n:::\n\n\n## Data exploring and cleaning\n\nA quick overview of the imported data using the `summary()` function.\n\n::: {.cell}\n\n```{.r .cell-code}\n#overview of data\nsummary(data)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                                           DxName1   \n Influenza like illness - Clinical Dx          :328  \n Influenza - Virus Identified                  :131  \n Fever, unspecified                            :101  \n Cough                                         : 66  \n Acute pharyngitis, unspecified                : 50  \n Acute upper respiratory infection, unspecified: 22  \n (Other)                                       : 37  \n                                 DxName2   \n Influenza - Virus Identified        :126  \n Influenza like illness - Clinical Dx:115  \n Fever, unspecified                  : 45  \n Cough                               : 41  \n Acute pharyngitis, unspecified      : 31  \n (Other)                             : 97  \n NA's                                :280  \n                                 DxName3   \n Influenza - Virus Identified        : 23  \n Influenza like illness - Clinical Dx: 14  \n Cough                               : 10  \n Fever, unspecified                  :  6  \n Acute pharyngitis, unspecified      :  4  \n (Other)                             : 52  \n NA's                                :626  \n                                           DxName4   \n Influenza - Virus Identified                  :  3  \n Acute upper respiratory infection, unspecified:  2  \n Encounter for immunization                    :  2  \n Influenza like illness - Clinical Dx          :  2  \n Acute pharyngitis, unspecified                :  1  \n (Other)                                       :  9  \n NA's                                          :716  \n                                                                                               DxName5   \n Acute suppurative otitis media without spontaneous rupture of ear drum, right ear                 :  0  \n Encounter for immunization                                                                        :  0  \n Headache                                                                                          :  1  \n Other infectious mononucleosis without complication                                               :  0  \n Strain of other flexor muscle, fascia and tendon at forearm level, right arm, subsequent encounter:  0  \n NA's                                                                                              :734  \n                                                                                                         \n Unique.Visit       ActivityLevel    ActivityLevelF SwollenLymphNodes\n Length:735         Min.   : 0.000   3      :125    No :421          \n Class :character   1st Qu.: 3.000   5      : 97    Yes:314          \n Mode  :character   Median : 4.000   4      : 95                     \n                    Mean   : 4.463   2      : 80                     \n                    3rd Qu.: 6.000   7      : 68                     \n                    Max.   :10.000   6      : 66                     \n                                     (Other):204                     \n ChestCongestion ChillsSweats NasalCongestion CoughYN   Sneeze    Fatigue  \n No :326         No :131      No :170         No : 75   No :340   No : 64  \n Yes:409         Yes:604      Yes:565         Yes:660   Yes:395   Yes:671  \n                                                                           \n                                                                           \n                                                                           \n                                                                           \n                                                                           \n SubjectiveFever Headache      Weakness   WeaknessYN  CoughIntensity CoughYN2 \n No :230         No :115   None    : 49   No : 49    None    : 47    No : 47  \n Yes:505         Yes:620   Mild    :224   Yes:686    Mild    :156    Yes:688  \n                           Moderate:341              Moderate:360             \n                           Severe  :121              Severe  :172             \n                                                                              \n                                                                              \n                                                                              \n     Myalgia    MyalgiaYN RunnyNose AbPain    ChestPain Diarrhea  EyePn    \n None    : 79   No : 79   No :211   No :642   No :501   No :636   No :622  \n Mild    :214   Yes:656   Yes:524   Yes: 93   Yes:234   Yes: 99   Yes:113  \n Moderate:327                                                              \n Severe  :115                                                              \n                                                                           \n                                                                           \n                                                                           \n Insomnia  ItchyEye  Nausea    EarPn     Hearing   Pharyngitis Breathless\n No :316   No :553   No :477   No :573   No :705   No :121     No :438   \n Yes:419   Yes:182   Yes:258   Yes:162   Yes: 30   Yes:614     Yes:297   \n                                                                         \n                                                                         \n                                                                         \n                                                                         \n                                                                         \n ToothPn   Vision    Vomit     Wheeze       BodyTemp     \n No :569   No :716   No :656   No :514   Min.   : 97.20  \n Yes:166   Yes: 19   Yes: 79   Yes:221   1st Qu.: 98.20  \n                                         Median : 98.50  \n                                         Mean   : 98.94  \n                                         3rd Qu.: 99.30  \n                                         Max.   :103.10  \n                                         NA's   :5       \n                                RapidFluA  \n Positive for Influenza A            :169  \n Presumptive Negative For Influenza A:159  \n NA's                                :407  \n                                           \n                                           \n                                           \n                                           \n                                RapidFluB                        PCRFluA   \n Positive for Influenza B            : 26    Influenza A Detected    :120  \n Presumptive Negative For Influenza B:302    Influenza A Not Detected: 33  \n NA's                                :407   Assay Invalid            :  0  \n                                            Indeterminate            :  1  \n                                            NA's                     :581  \n                                                                           \n                                                                           \n                      PCRFluB     TransScore1    TransScore1F  TransScore2   \n  Influenza B Detected    :  9   Min.   :0.000   0: 13        Min.   :0.000  \n  Influenza B Not Detected:145   1st Qu.:3.000   1: 53        1st Qu.:2.000  \n Assay Invalid            :  0   Median :4.000   2:107        Median :3.000  \n NA's                     :581   Mean   :3.473   3:157        Mean   :2.917  \n                                 3rd Qu.:5.000   4:210        3rd Qu.:4.000  \n                                 Max.   :5.000   5:195        Max.   :4.000  \n                                                                             \n TransScore2F  TransScore3    TransScore3F  TransScore4    TransScore4F\n 0: 13        Min.   :0.000   0: 24        Min.   :0.000   0: 50       \n 1: 89        1st Qu.:1.000   1:166        1st Qu.:2.000   1:103       \n 2:138        Median :2.000   2:222        Median :3.000   2:154       \n 3:201        Mean   :2.148   3:323        Mean   :2.576   3:230       \n 4:294        3rd Qu.:3.000                3rd Qu.:4.000   4:198       \n              Max.   :3.000                Max.   :4.000               \n                                                                       \n  ImpactScore      ImpactScore2     ImpactScore3    ImpactScoreF ImpactScore2F\n Min.   : 2.000   Min.   : 2.000   Min.   : 0.00   8      :105   7      :107  \n 1st Qu.: 8.000   1st Qu.: 7.000   1st Qu.: 3.00   9      :104   8      :102  \n Median : 9.000   Median : 8.000   Median : 5.00   10     : 88   9      : 90  \n Mean   : 9.514   Mean   : 8.581   Mean   : 5.06   7      : 84   10     : 86  \n 3rd Qu.:11.000   3rd Qu.:10.000   3rd Qu.: 7.00   11     : 82   6      : 85  \n Max.   :18.000   Max.   :17.000   Max.   :13.00   12     : 58   11     : 59  \n                                                   (Other):214   (Other):206  \n ImpactScore3F ImpactScoreFD   TotalSymp1     TotalSymp1F    TotalSymp2   \n 4      :134   8      :105   Min.   : 5.00   12     : 86   Min.   : 4.00  \n 5      :112   9      :104   1st Qu.:11.00   13     : 84   1st Qu.:10.00  \n 3      :108   10     : 88   Median :13.00   14     : 80   Median :12.00  \n 6      :102   7      : 84   Mean   :12.99   11     : 72   Mean   :12.43  \n 7      : 66   11     : 82   3rd Qu.:15.00   10     : 62   3rd Qu.:15.00  \n 2      : 64   12     : 58   Max.   :23.00   15     : 61   Max.   :22.00  \n (Other):149   (Other):214                   (Other):290                  \n   TotalSymp3   \n Min.   : 3.00  \n 1st Qu.:10.00  \n Median :12.00  \n Mean   :11.66  \n 3rd Qu.:14.00  \n Max.   :21.00  \n                \n```\n:::\n:::\n\nThe symptom variables are mostly categorical, and there are diagnostic and other coding variables in the \"DxName\", \"Impact\", and \"TotalSymp\" columns that we will remove to focus specifically on the predictor and outcome variables of interest. \n\nWe will go ahead and remove the extra columns, producing a data frame with 735 rows and 32 columns.\n\n::: {.cell}\n\n```{.r .cell-code}\n#remove extra columns\ndata2 <- data %>% \n  select(!contains(\"Total\") &\n           !contains(\"Score\") &\n           !contains(\"FluA\") &\n           !contains(\"FluB\") &\n           !contains(\"Dxname\") &\n           !contains(\"Activity\")) %>% \n  select(!\"Unique.Visit\")\ndim(data2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 735  32\n```\n:::\n:::\n\nWe can also see that some variables have both a Yes/No question and a level of severity. We can remove the Yes/No columns and keep only the severity, which should remove 4 variables.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#remove Yes/No columns if variable also has severity levels\ndata2 <- data2 %>% \n  select(!contains(\"WeaknessYN\") &\n           !contains(\"CoughYN\") &\n           !contains(\"CoughYN2\") &\n           !contains(\"MyalgiaYN\"))\ndim(data2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 735  28\n```\n:::\n:::\n\nNow that we have the columns we need, we will check for any missing data and remove the NAs. \n\n::: {.cell}\n\n```{.r .cell-code}\n#check for NAs and drop\ngg_miss_var(data2)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: The `guide` argument in `scale_*()` cannot be `FALSE`. This was deprecated in\nggplot2 3.3.4.\nℹ Please use \"none\" instead.\nℹ The deprecated feature was likely used in the naniar package.\n  Please report the issue at <https://github.com/njtierney/naniar/issues>.\n```\n:::\n\n::: {.cell-output-display}\n![](wrangling_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n\n```{.r .cell-code}\ncleandata <- drop_na(data2)\n```\n:::\n\n\n## Save clean data\nThe data has been cleaned! We will save the cleaned data as `cleandata` in the `data` folder. \n\n::: {.cell}\n\n```{.r .cell-code}\n#save cleaned data\nfilelocation <- here(\"fluanalysis\", \"data\", \"cleandata.rds\")\nsave(cleandata, file = filelocation)\n```\n:::\n",
    "supporting": [
      "wrangling_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}