{
  "hash": "69633acc13c52e4fac053b529dc4ca8e",
  "result": {
    "markdown": "---\ntitle: \"Data Analysis Exercise\"\noutput: html_document\n---\n\n\nThis page will be used for my first exercise in data analysis involving data importing and wrangling.\n\n## Describing the data source\n\nI chose the use the CDC dataset documenting the [deaths in 122 US cities from pneumonia or influenza by age group in 2015](https://data.cdc.gov/dataset/TABLE-III-Deaths-in-122-U-S-cities/7esm-uptm). These deaths were counted if the death certificates indicated that pneumonia or influenza was listed as underlying or contributed as cause of death. The data was obtained by voluntary reporting from each city for each week of 2015. If data was unavailable, a \"U\" was inputted, and if no cases were reported, a dash (-) was inputted.\n\n## Potential research question\n\nWhen I came across this dataset, my initial research question was to explore the trends in pneumonia and influenza deaths in 2015 by age groups. This can also be further analyzed by city, state, or even region of the US. For now, I will focus on setting up a complete dataset by age group.\n\n## Load packages\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(readr)\nlibrary(dplyr)\nlibrary(naniar)\n```\n:::\n\n\n## Importing the data\n\nTo import the data, I will be using `read_csv()` from the `readr` package.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# import data and assign to deathdata\ndeathdata <- read_csv(\"dataanalysis_exercise/rawdata/TABLE_III._Deaths_in_122_U.S._cities.csv\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nRows: 6864 Columns: 19\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (9): Reporting Area, All causes, by age (years), All Ages**, flag, All c...\ndbl (9): MMWR YEAR, MMWR WEEK, All causes, by age (years), All Ages**, All c...\nlgl (1): Location 2\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n:::\n\n```{.r .cell-code}\n#view general aspects about data\nsummary(deathdata)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n Reporting Area       MMWR YEAR      MMWR WEEK    \n Length:6864        Min.   :2015   Min.   : 1.00  \n Class :character   1st Qu.:2015   1st Qu.:13.75  \n Mode  :character   Median :2015   Median :26.50  \n                    Mean   :2015   Mean   :26.50  \n                    3rd Qu.:2015   3rd Qu.:39.25  \n                    Max.   :2015   Max.   :52.00  \n                                                  \n All causes, by age (years), All Ages**\n Min.   :    1.0                       \n 1st Qu.:   40.0                       \n Median :   78.0                       \n Mean   :  278.1                       \n 3rd Qu.:  151.0                       \n Max.   :15261.0                       \n NA's   :313                           \n All causes, by age (years), All Ages**, flag All causes, by age (years), ?65\n Length:6864                                  Min.   :    1.0                \n Class :character                             1st Qu.:   28.0                \n Mode  :character                             Median :   53.0                \n                                              Mean   :  188.5                \n                                              3rd Qu.:  101.0                \n                                              Max.   :10569.0                \n                                              NA's   :318                    \n All causes, by age (years), ?65, flag All causes, by age (years), 45–64\n Length:6864                           Min.   :   1.00                  \n Class :character                      1st Qu.:   8.00                  \n Mode  :character                      Median :  18.00                  \n                                       Mean   :  63.68                  \n                                       3rd Qu.:  36.00                  \n                                       Max.   :3361.00                  \n                                       NA's   :379                      \n All causes, by age (years), 45–64, flag All causes, by age (years), 25–44\n Length:6864                             Min.   :  1.00                   \n Class :character                        1st Qu.:  2.00                   \n Mode  :character                        Median :  5.00                   \n                                         Mean   : 18.21                   \n                                         3rd Qu.: 11.00                   \n                                         Max.   :858.00                   \n                                         NA's   :976                      \n All causes, by age (years), 25–44, flag All causes, by age (years), 1–24\n Length:6864                             Min.   :  1.000                 \n Class :character                        1st Qu.:  1.000                 \n Mode  :character                        Median :  3.000                 \n                                         Mean   :  8.201                 \n                                         3rd Qu.:  5.000                 \n                                         Max.   :299.000                 \n                                         NA's   :2394                    \n All causes, by age (years), 1–24, flag All causes, by age (years), LT 1\n Length:6864                            Min.   :  1.000                 \n Class :character                       1st Qu.:  1.000                 \n Mode  :character                       Median :  2.000                 \n                                        Mean   :  7.233                 \n                                        3rd Qu.:  5.000                 \n                                        Max.   :232.000                 \n                                        NA's   :2747                    \n All causes, by age (years), LT 1, flag   P&I† Total      P&I† Total, flag  \n Length:6864                            Min.   :   1.00   Length:6864       \n Class :character                       1st Qu.:   3.00   Class :character  \n Mode  :character                       Median :   6.00   Mode  :character  \n                                        Mean   :  19.83                     \n                                        3rd Qu.:  12.00                     \n                                        Max.   :1339.00                     \n                                        NA's   :973                         \n  Location 1        Location 2    \n Length:6864        Mode:logical  \n Class :character   NA's:6864     \n Mode  :character                 \n                                  \n                                  \n                                  \n                                  \n```\n:::\n\n```{.r .cell-code}\nstr(deathdata)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nspc_tbl_ [6,864 × 19] (S3: spec_tbl_df/tbl_df/tbl/data.frame)\n $ Reporting Area                              : chr [1:6864] \"Albany, NY\" \"Allentown, PA\" \"Buffalo, NY\" \"Camden, NJ\" ...\n $ MMWR YEAR                                   : num [1:6864] 2015 2015 2015 2015 2015 ...\n $ MMWR WEEK                                   : num [1:6864] 4 4 4 4 4 4 4 4 4 4 ...\n $ All causes, by age (years), All Ages**      : num [1:6864] 61 30 100 31 17 ...\n $ All causes, by age (years), All Ages**, flag: chr [1:6864] NA NA NA NA ...\n $ All causes, by age (years), ?65             : num [1:6864] 47 22 75 13 12 55 19 866 27 NA ...\n $ All causes, by age (years), ?65, flag       : chr [1:6864] NA NA NA NA ...\n $ All causes, by age (years), 45–64           : num [1:6864] 11 4 19 9 2 11 4 188 9 NA ...\n $ All causes, by age (years), 45–64, flag     : chr [1:6864] NA NA NA NA ...\n $ All causes, by age (years), 25–44           : num [1:6864] 1 3 4 6 3 2 NA 35 8 NA ...\n $ All causes, by age (years), 25–44, flag     : chr [1:6864] NA NA NA NA ...\n $ All causes, by age (years), 1–24            : num [1:6864] 2 1 1 2 NA 1 NA 13 NA NA ...\n $ All causes, by age (years), 1–24, flag      : chr [1:6864] NA NA NA NA ...\n $ All causes, by age (years), LT 1            : num [1:6864] NA NA 1 1 NA NA NA 7 2 NA ...\n $ All causes, by age (years), LT 1, flag      : chr [1:6864] \"-\" \"-\" NA NA ...\n $ P&I† Total                                  : num [1:6864] 4 1 14 2 2 7 2 59 1 NA ...\n $ P&I† Total, flag                            : chr [1:6864] NA NA NA NA ...\n $ Location 1                                  : chr [1:6864] \"Albany, NY\\n(42.651242, -73.755418)\" \"Allentown, PA\\n(40.602753, -75.469759)\" \"Buffalo, NY\\n(39.945422, -78.64671)\" \"Camden, NJ\\n(39.945208, -75.118833)\" ...\n $ Location 2                                  : logi [1:6864] NA NA NA NA NA NA ...\n - attr(*, \"spec\")=\n  .. cols(\n  ..   `Reporting Area` = col_character(),\n  ..   `MMWR YEAR` = col_double(),\n  ..   `MMWR WEEK` = col_double(),\n  ..   `All causes, by age (years), All Ages**` = col_double(),\n  ..   `All causes, by age (years), All Ages**, flag` = col_character(),\n  ..   `All causes, by age (years), ?65` = col_double(),\n  ..   `All causes, by age (years), ?65, flag` = col_character(),\n  ..   `All causes, by age (years), 45–64` = col_double(),\n  ..   `All causes, by age (years), 45–64, flag` = col_character(),\n  ..   `All causes, by age (years), 25–44` = col_double(),\n  ..   `All causes, by age (years), 25–44, flag` = col_character(),\n  ..   `All causes, by age (years), 1–24` = col_double(),\n  ..   `All causes, by age (years), 1–24, flag` = col_character(),\n  ..   `All causes, by age (years), LT 1` = col_double(),\n  ..   `All causes, by age (years), LT 1, flag` = col_character(),\n  ..   `P&I† Total` = col_double(),\n  ..   `P&I† Total, flag` = col_character(),\n  ..   `Location 1` = col_character(),\n  ..   `Location 2` = col_logical()\n  .. )\n - attr(*, \"problems\")=<externalptr> \n```\n:::\n\n```{.r .cell-code}\ngg_miss_var(deathdata)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: The `guide` argument in `scale_*()` cannot be `FALSE`. This was deprecated in\nggplot2 3.3.4.\nℹ Please use \"none\" instead.\nℹ The deprecated feature was likely used in the naniar package.\n  Please report the issue at <https://github.com/njtierney/naniar/issues>.\n```\n:::\n\n::: {.cell-output-display}\n![](dataanalysis_exercise_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\nLooking at the `summary()` and `str()` output, the dataset has a row for each city (identified in the Reporting Area column) for each MMWR week of the year. The columns marked as flag only contains NAs and marked as character variables. The other columns contain the number of deaths for each age group. There are a total of 6864 observations. Notice also the dashes (representing no reported cases) does not accurately represent the report since the minimum for the age group columns is 1. Exploring further, the `gg_miss_var()` from the `naniar` package reports the number of missing values by variable, which the flagged and location columns having the highest number of missing data points.\n\nNote: in the original CDC database, the summary of the dataset indicated there would be ages groups of 65-75 years and 85+ years. I do not see those age groups on the actual data available.\n\n## Cleaning the data\n\nLet's start cleaning the data by changing the column names to something easier to work with. Since I am only interested in the age group columns, I will only be renaming these.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#rename columns for easier cleaning and assign to RNdeathdata\nRNdeathdata <- deathdata %>% \n  rename(AllAges = `All causes, by age (years), All Ages**`,\n         AllAgesFlag = `All causes, by age (years), All Ages**, flag`,\n         AgesOver65 = `All causes, by age (years), ?65`,\n         AgesOver65Flag = `All causes, by age (years), ?65, flag`,\n         Ages45to64 = `All causes, by age (years), 45–64`,\n         Ages45to64Flag = `All causes, by age (years), 45–64, flag`,\n         Ages25to44 = `All causes, by age (years), 25–44`,\n         Ages25to44Flag = `All causes, by age (years), 25–44, flag`,\n         Ages1to24 = `All causes, by age (years), 1–24`,\n         Ages1to24Flag = `All causes, by age (years), 1–24, flag`)\n```\n:::\n\n\nNext, I want to find which columns contain the dashes (for zero cases) and \"U\" for unreported data.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#finding dashes and \"U\" in data set by column\nstr_detect(RNdeathdata, \"-\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning in stri_detect_regex(string, pattern, negate = negate, opts_regex =\nopts(pattern)): argument is not an atomic vector; coercing\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] FALSE FALSE FALSE FALSE  TRUE FALSE  TRUE FALSE  TRUE FALSE  TRUE FALSE\n[13]  TRUE FALSE  TRUE FALSE  TRUE  TRUE FALSE\n```\n:::\n\n```{.r .cell-code}\nstr_detect(RNdeathdata, \"U\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning in stri_detect_regex(string, pattern, negate = negate, opts_regex =\nopts(pattern)): argument is not an atomic vector; coercing\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n [1]  TRUE FALSE FALSE FALSE  TRUE FALSE  TRUE FALSE  TRUE FALSE  TRUE FALSE\n[13]  TRUE FALSE  TRUE FALSE  TRUE  TRUE FALSE\n```\n:::\n:::\n\n\nUsing the `str_detect()` function, we can see the same columns have dashes and \"u\" (except for the Reporting Area column which contains \"u\" as part of the city names). Looking back at the output from str() in the above step, the flagged columns as well as Location 1 column have the dashes and unreported data. Since I will be removing the flagged columns but want to preserve the values that are meant to be zero for that age group in that city for that week, I will translate the dashes into 0s for the corresponding columns.\n\nLet's go ahead and remove the rows with unreported data and change the dashes into 0s for the corresponding columns.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#remove observations with unreported data and assign to data2\ndata2<- RNdeathdata %>% \n  filter(!`AgesOver65Flag` == \"U\" |\n         !`All causes, by age (years), LT 1, flag` == \"U\" |\n         !`Ages1to24Flag` == \"U\" |\n         !`Ages45to64Flag` == \"U\" |\n         !`Ages25to44Flag` == \"U\")\n\n#translate dashes from flagged columns into 0 for the corresponding age group columns and assign to data3\ndata3 <- data2 %>% \n  mutate(`AgesOver65` = case_when(`AgesOver65Flag` == \"-\" ~ 0, TRUE ~ AgesOver65),\n         `Ages45to64` = case_when(`Ages45to64Flag` == \"-\" ~ 0, TRUE ~ Ages45to64),\n         `Ages25to44` = case_when(`Ages25to44Flag` == \"-\" ~ 0, TRUE ~ Ages25to44),\n         `Ages1to24` = case_when(`Ages1to24Flag` == \"-\" ~ 0, TRUE ~ Ages1to24),\n         `AllAges` = case_when(`AllAgesFlag` == \"-\" ~ 0, TRUE ~ AllAges))\n\n#check for missing data\ngg_miss_var(data3)\n```\n\n::: {.cell-output-display}\n![](dataanalysis_exercise_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\nAs seen with the missing variable graph, we have full data sets for the non-flagged columns which means the observations in the flagged columns with dashes had NAs in the non-flagged age groups. Now we can remove those columns and focus only on the age groups. I also can remove the Year column since the data is from 2015.\n\n## Select final columns of data\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#select age group columns, MMWR week, and Reporting Area and assign to cleandeathdata\ncleandeathdata <- data3 %>% \n  select(!contains(\"Flag\") & \n           -c(\"Location 1\", \"Location 2\", \"MMWR YEAR\", \n              \"All causes, by age (years), LT 1\", \"P&I† Total\"))\n\nsummary(cleandeathdata)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n Reporting Area       MMWR WEEK       AllAges         AgesOver65    \n Length:3322        Min.   : 1.0   Min.   :  0.00   Min.   :  0.00  \n Class :character   1st Qu.:13.0   1st Qu.: 23.00   1st Qu.: 16.00  \n Mode  :character   Median :26.0   Median : 41.00   Median : 30.00  \n                    Mean   :26.4   Mean   : 50.65   Mean   : 35.93  \n                    3rd Qu.:40.0   3rd Qu.: 68.00   3rd Qu.: 48.00  \n                    Max.   :52.0   Max.   :321.00   Max.   :236.00  \n   Ages45to64      Ages25to44       Ages1to24      \n Min.   : 0.00   Min.   : 0.000   Min.   : 0.0000  \n 1st Qu.: 4.00   1st Qu.: 1.000   1st Qu.: 0.0000  \n Median : 9.00   Median : 2.000   Median : 0.0000  \n Mean   :10.92   Mean   : 2.668   Mean   : 0.6409  \n 3rd Qu.:15.00   3rd Qu.: 4.000   3rd Qu.: 1.0000  \n Max.   :79.00   Max.   :27.000   Max.   :18.0000  \n```\n:::\n:::\n\n\nThe final dataframe `cleandeathdata` contains information for 122 cities that reported weekly number of deaths due to pneumonia or influenza by age group in 2015.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#save cleaned data in RDS file in cleandata folder\nsaveRDS(cleandeathdata, file = \"dataanalysis_exercise/cleandata/cleandeathdata.rds\")\n\n#save summary table as RDS file in results folder\nsummarytable = data.frame(do.call(cbind, lapply(cleandeathdata, summary)))\nprint(summarytable)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n        Reporting.Area        MMWR.WEEK          AllAges       AgesOver65\nMin.              3322                1                0                0\n1st Qu.      character               13               23               16\nMedian       character               26               41               30\nMean              3322 26.4021673690548 50.6493076459964 35.9292594822396\n3rd Qu.      character               40               68               48\nMax.         character               52              321              236\n             Ages45to64      Ages25to44         Ages1to24\nMin.                  0               0                 0\n1st Qu.               4               1                 0\nMedian                9               2                 0\nMean    10.917820590006 2.6676700782661 0.640878988561108\n3rd Qu.              15               4                 1\nMax.                 79              27                18\n```\n:::\n\n```{.r .cell-code}\nsaveRDS(summarytable, file = \"dataanalysis_exercise/results/summarytable.rds\")\n```\n:::\n\n\n# This section added by Leah Lariscy\n\n## Loading the data\n\nHere, I will read in the above RDS file\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndeath_LML <- read_rds(\"dataanalysis_exercise/cleandata/cleandeathdata.rds\")\n```\n:::\n\n\nNext, I will take a look at the data and check that there are no NAs again\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntibble(death_LML)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 3,322 × 7\n   `Reporting Area` `MMWR WEEK` AllAges AgesOver65 Ages45to64 Ages25to44 Ages1…¹\n   <chr>                  <dbl>   <dbl>      <dbl>      <dbl>      <dbl>   <dbl>\n 1 Albany, NY                 4      61         47         11          1       2\n 2 Allentown, PA              4      30         22          4          3       1\n 3 Elizabeth, NJ              4      17         12          2          3       0\n 4 Erie, PA                   4      69         55         11          2       1\n 5 Jersey City, NJ            4      23         19          4          0       0\n 6 Newark, NJ                 4      46         27          9          8       0\n 7 Pittsburgh, PA§            4      48         37         10          1       0\n 8 Reading, PA                4      27         20          4          2       1\n 9 Schenectady, NY            4      45         32         12          1       0\n10 Scranton, PA               4      34         25          6          2       0\n# … with 3,312 more rows, and abbreviated variable name ¹​Ages1to24\n```\n:::\n\n```{.r .cell-code}\ngg_miss_var(death_LML)\n```\n\n::: {.cell-output-display}\n![](dataanalysis_exercise_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n## Further data cleaning\n\nAfter looking at the data, I want to pull apart `Reporting Area` into `State` and `City` so I can then compare data across states. I am also removing the variable `AllAges` so that I can use `pivot_longer` and this column will cause issues when I am trying to plot. Also, I will easily be able to calculate this again, if needed, by grouping by `city` and `state` and using `mutate` to report the sum.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Use the separate function\nclean_death_LML <- death_LML %>% separate(col = `Reporting Area`, into = c(\"city\",\"state\"), sep = \", \") %>% select(!AllAges)\n```\n:::\n\n\nI need to use `pivot_longer` because I'd like to create a new variable `age_group` that all the age groups can go underneath. This way, it will be much easier to create plots from.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nclean_death_long_LML <- clean_death_LML %>% pivot_longer(cols = c(AgesOver65,Ages45to64,Ages25to44,Ages1to24), names_to = \"age_group\") %>% rename(deaths = value)\ntibble(clean_death_long_LML)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 13,288 × 5\n   city      state `MMWR WEEK` age_group  deaths\n   <chr>     <chr>       <dbl> <chr>       <dbl>\n 1 Albany    NY              4 AgesOver65     47\n 2 Albany    NY              4 Ages45to64     11\n 3 Albany    NY              4 Ages25to44      1\n 4 Albany    NY              4 Ages1to24       2\n 5 Allentown PA              4 AgesOver65     22\n 6 Allentown PA              4 Ages45to64      4\n 7 Allentown PA              4 Ages25to44      3\n 8 Allentown PA              4 Ages1to24       1\n 9 Elizabeth NJ              4 AgesOver65     12\n10 Elizabeth NJ              4 Ages45to64      2\n# … with 13,278 more rows\n```\n:::\n:::\n\n\n## Exploratory analysis\n\nHere, I will plot `age_group` on the x-axis and `deaths` on the y-axis to compare total deaths per age group.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nclean_death_long_LML %>% ggplot(mapping = aes(x = age_group, y = deaths, fill = age_group)) +\n  geom_col() +\n  labs(title = \"Total influenza/pneumonia related deaths in the US per age group in 2015\",\n       x = \"Age Group\",\n       y = \"Deaths\",\n       fill = \"Age Group\") \n```\n\n::: {.cell-output-display}\n![](dataanalysis_exercise_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\nFrom this plot, we see that number of deaths increases as age groups increase.\n\nHere, I am grouping by `state` and `age_group` to look at deaths per age group across each state.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstate_deaths <- clean_death_long_LML %>% group_by(state, age_group) %>% mutate(state_deaths_per_age = sum(deaths)) %>% ungroup()\n```\n:::\n\n\nHere, I will plot `state` on the x-axis and `state_deaths_per_age` on the y-axis, colored by `age_group`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstate_deaths %>% ggplot(aes(state, state_deaths_per_age, fill = age_group)) +\n  geom_col() +\n  labs(title = \"Total influenza/pneumonia related deaths in the US by state and age group, 2015\",\n       x = \"State\",\n       y = \"Deaths per state\",\n       fill = \"Age Group\") +\n   theme(axis.text.x.bottom = element_text(angle = 90))\n```\n\n::: {.cell-output-display}\n![](dataanalysis_exercise_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n\nThis plot shows certain states with much higher flu/pneumonia related deaths (New York, Massachusetts, California). This could be due to many factors, population size likely being one of them. Each state seems to follow a similar trend in death proportions per age group.\n",
    "supporting": [
      "dataanalysis_exercise_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}