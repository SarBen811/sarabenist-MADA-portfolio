{
  "hash": "054ae9903a09cac82d2839ad5cd161e3",
  "result": {
    "markdown": "---\ntitle: \"Visualization Exercise\"\noutput:\n  html_document:\n    toc: FALSE\n---\n\n\n## Data source and description\n\nThe data I will use is from the FiveThirtyEight article [\"Some People Are Too Superstitious To Have A Baby On Friday The 13th\"](https://fivethirtyeight.com/features/some-people-are-too-superstitious-to-have-a-baby-on-friday-the-13th/) and the associated [GitHub repository](https://github.com/fivethirtyeight/data/tree/master/births). This article uses data from the National Center for Health Statistics (1994 - 2003) and the Social Security Administration (2000 - 2014). The two data files contain information on the year, month, date (as in number of the month), day of the week (1 represents Monday and 7 represents Sunday), and number of births for each date. For this exercise, I will be attempting to remake the first figure of the article shown below. ![](VEorignalgraph.webp){width=\"451\"}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(readr)\nlibrary(tidyverse)\nlibrary(ggthemes)\n```\n:::\n\n\n## Data loading\n\nI downloaded the data files and placed them into the data folder as `births1` and `births2`. Using the `read_delim()` function, these data sets will be assigned as `data1` and `data2`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata1 <- read_delim(file = \"data/births1.txt\")\ndata2 <- read_delim(file = \"data/births2.txt\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#summary of datasets\nsummary(data1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n      year          month        date_of_month    day_of_week     births     \n Min.   :1994   Min.   : 1.000   Min.   : 1.00   Min.   :1    Min.   : 6443  \n 1st Qu.:1996   1st Qu.: 4.000   1st Qu.: 8.00   1st Qu.:2    1st Qu.: 8844  \n Median :1998   Median : 7.000   Median :16.00   Median :4    Median :11615  \n Mean   :1998   Mean   : 6.524   Mean   :15.73   Mean   :4    Mean   :10877  \n 3rd Qu.:2001   3rd Qu.:10.000   3rd Qu.:23.00   3rd Qu.:6    3rd Qu.:12274  \n Max.   :2003   Max.   :12.000   Max.   :31.00   Max.   :7    Max.   :14540  \n```\n:::\n\n```{.r .cell-code}\nsummary(data2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n      year          month        date_of_month    day_of_week     births     \n Min.   :2000   Min.   : 1.000   Min.   : 1.00   Min.   :1    Min.   : 5728  \n 1st Qu.:2003   1st Qu.: 4.000   1st Qu.: 8.00   1st Qu.:2    1st Qu.: 8740  \n Median :2007   Median : 7.000   Median :16.00   Median :4    Median :12343  \n Mean   :2007   Mean   : 6.523   Mean   :15.73   Mean   :4    Mean   :11350  \n 3rd Qu.:2011   3rd Qu.:10.000   3rd Qu.:23.00   3rd Qu.:6    3rd Qu.:13082  \n Max.   :2014   Max.   :12.000   Max.   :31.00   Max.   :7    Max.   :16081  \n```\n:::\n\n```{.r .cell-code}\n#check number of rows to identify potential issues when joining\nnrow(data1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 3652\n```\n:::\n\n```{.r .cell-code}\nnrow(data2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 5479\n```\n:::\n:::\n\n\nLooking at the summary of the datasets, `data1` contains information for years 1994-2003, and `data2` for years 2000-2014. The columns for month, date_of_month, and day_of_week match, and the second dataset has more observations compared to the first.\n\n## Join data sets from sources\n\nThe graph uses data from the years 1994-2014, so we need to join the datasets together to analyze. According to the footnote, the data of the overlapping years did not greatly differ. We can now join the two data sets with `full_join()`. We should use full join rather than other `_join()` options in order to preserve as much data as possible.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#join both data sets and assign to fulldata\nfulldata <- full_join(data1, data2)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nJoining, by = c(\"year\", \"month\", \"date_of_month\", \"day_of_week\", \"births\")\n```\n:::\n\n```{.r .cell-code}\n#visual display of 10 random observations in fulldata set\nslice_sample(fulldata, n = 10)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 10 × 5\n    year month date_of_month day_of_week births\n   <dbl> <dbl>         <dbl>       <dbl>  <dbl>\n 1  1995     4            15           6   8492\n 2  2003     3            13           4  12333\n 3  2011     9             1           4  13723\n 4  1997    10            21           2  11957\n 5  2010    11             8           1  12023\n 6  1998     2            10           2  12166\n 7  2001     4            11           3  12631\n 8  1996     7            19           5  12049\n 9  2009    11            11           3  12889\n10  2013    12             9           1  11824\n```\n:::\n\n```{.r .cell-code}\n#summary of dataset and check for joining issues\nsummary(fulldata)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n      year          month        date_of_month    day_of_week     births     \n Min.   :1994   Min.   : 1.000   Min.   : 1.00   Min.   :1    Min.   : 5728  \n 1st Qu.:2000   1st Qu.: 4.000   1st Qu.: 8.00   1st Qu.:2    1st Qu.: 8787  \n Median :2003   Median : 7.000   Median :16.00   Median :4    Median :11998  \n Mean   :2004   Mean   : 6.523   Mean   :15.73   Mean   :4    Mean   :11161  \n 3rd Qu.:2008   3rd Qu.:10.000   3rd Qu.:23.00   3rd Qu.:6    3rd Qu.:12774  \n Max.   :2014   Max.   :12.000   Max.   :31.00   Max.   :7    Max.   :16081  \n```\n:::\n\n```{.r .cell-code}\nstr(fulldata)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nspc_tbl_ [9,131 × 5] (S3: spec_tbl_df/tbl_df/tbl/data.frame)\n $ year         : num [1:9131] 1994 1994 1994 1994 1994 ...\n $ month        : num [1:9131] 1 1 1 1 1 1 1 1 1 1 ...\n $ date_of_month: num [1:9131] 1 2 3 4 5 6 7 8 9 10 ...\n $ day_of_week  : num [1:9131] 6 7 1 2 3 4 5 6 7 1 ...\n $ births       : num [1:9131] 8096 7772 10142 11248 11053 ...\n - attr(*, \"spec\")=\n  .. cols(\n  ..   year = col_double(),\n  ..   month = col_double(),\n  ..   date_of_month = col_double(),\n  ..   day_of_week = col_double(),\n  ..   births = col_double()\n  .. )\n - attr(*, \"problems\")=<externalptr> \n```\n:::\n:::\n\n\nThe `fulldata` set now contains information for 1994-2014 with 9131 observations. The columns are the same as the original two datasets.\n\n## Manipulate data\n\nNow that we have the data for the full range of years, we need to manipulate the data to find the average number of births on the 6th or 20th of the month compared to the average number of of births on the 13th of the month. Since the graph is separated by weekday, we need to first group by weekday.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#assign to plot1data and create 3 new variables\nplot1data <- fulldata %>% group_by(day_of_week) %>% \n  summarise(avg620 = mean(births[date_of_month == 6 | date_of_month == 20]), #average number of births on each weekday for the 6th or 20th of the month\n            avg13 = mean(births[date_of_month == 13])) %>% #the average number of births on each weekday for the 13th of the month\n  mutate(pctdiff = (avg13-avg620)/avg13 *100) #the percent difference for each weekday\n\n#check the new data set\nhead(plot1data, 7)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 7 × 4\n  day_of_week avg620  avg13 pctdiff\n        <dbl>  <dbl>  <dbl>   <dbl>\n1           1 11645. 11394.  -2.21 \n2           2 12870. 12600.  -2.15 \n3           3 12774. 12394.  -3.07 \n4           4 12713. 12280.  -3.52 \n5           5 12559. 11737.  -7.01 \n6           6  8655.  8600.  -0.641\n7           7  7636.  7560.  -1.00 \n```\n:::\n:::\n\n\nI want to also recode the `day_of_week` column into days rather than numbers for the graph labeling. To preserve the weekday order, I will need to change the variable into a factor using `mutate()` and `factor()` functions.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#recode days of the week for plot labels and factor to keep days ordered for graph\nplot1data<- plot1data %>% \n  mutate(day_of_week = case_when(\n    day_of_week %in% 1 ~ \"MON\",\n    day_of_week %in% 2 ~ \"TUES\",\n    day_of_week %in% 3 ~ \"WED\",\n    day_of_week %in% 4 ~ \"THURS\",\n    day_of_week %in% 5 ~ \"FRI\",\n    day_of_week %in% 6 ~ \"SAT\",\n    day_of_week %in% 7 ~ \"SUN\")) %>% \n  mutate(day_of_week = factor(day_of_week,\n        levels = c(\"MON\", \"TUES\", \"WED\", \"THURS\", \"FRI\", \"SAT\", \"SUN\")))\n  \n\n#check new dataset\nhead(plot1data, 7)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 7 × 4\n  day_of_week avg620  avg13 pctdiff\n  <fct>        <dbl>  <dbl>   <dbl>\n1 MON         11645. 11394.  -2.21 \n2 TUES        12870. 12600.  -2.15 \n3 WED         12774. 12394.  -3.07 \n4 THURS       12713. 12280.  -3.52 \n5 FRI         12559. 11737.  -7.01 \n6 SAT          8655.  8600.  -0.641\n7 SUN          7636.  7560.  -1.00 \n```\n:::\n:::\n\n\nThe new dataframe `plot1data` has a summary of the average number of births on the 6th or 20th and the average number of births on the 13th as well as the percent difference for each weekday. Notice that we needed to use the `summarise()` rather than the `mutate()` function to create the new variables. The `summarise()` function returns one row for a group of observations after a `group_by()` statement while `mutate()` returns the same number of rows as the original dataset.\n\n## Plot graph\n\nUsing the `plot1data`, we can attempt to recreate the graph using the `ggplot()` and associated functions. The `geom_col()` function will be the basis of the graph, and the `theme()`, `labs()`, `scale_x_discrete()`, `scale_y_continuous()` , and `scale_fill_manual()` functions all adjusted the graph elements to look like the original graph (or at least as close as I can get to it!).\n\nNote: Because I did not remove data for the national holidays that fall on either the 6th or 20th between 1994 to 2014, my graph data may not match the article's exactly, but the trends are still present.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#set up standard plot\nggplot(plot1data)+\n  geom_col(aes(x = day_of_week, y = pctdiff, fill = day_of_week), width = 0.75)+\n  theme_fivethirtyeight()+ #theme from article database\n\n#add labeling\n  labs(title = \"The Friday the 13th effect\",\n       subtitle = \"Difference in the share of U.S. births on the 13th of each month\\nfrom the average of births on the 6th and the 20th, 1994-2014\",\n       y = \"ppt\", x = NULL)+ # add title, subtitle, y axis title and remove x axis\n\n#add axis elements and bar colors\n  scale_x_discrete(position = \"top\")+ #move x axis to top of graph,\n  scale_y_continuous(breaks = c(0,-1,-2,-3,-4,-5,-6), labels = c(\"0 ppt\", \"-1\",\"-2\",\"-3\",\"-4\",\"-5\",\"-6\"))+ #define y axis tick marks and labels\n  scale_fill_manual(values =\n        c(\"#EBB7EC\", \"#EBB7EC\", \"#EBB7EC\", \"#EBB7EC\",\n                   \"#E22EDD\", \"#EBB7EC\", \"#EBB7EC\"))+ #bar colors\n                     \n#Adjust theme to match graph aesthetics\n  theme(panel.grid = element_line(colour = \"#E0E0E0\"), #light grey for grid lines\n        panel.background = element_rect(fill = \"#F0F0F0\"), #light grey for panel background\n        plot.background = element_rect(fill = \"#F0F0F0\" ), #light grey for graph background\n        axis.line.x = element_line(color = \"#808080\"), # black for x axis\n        axis.text = element_text(color = \"#b5b5b5\"), #grey color of axis labels\n        plot.title = element_text(face = \"bold\"), # bold title\n        plot.subtitle = element_text(size = 10), #change size of subtitle\n        legend.position = \"none\", # remove legend\n        axis.title.y = NULL) #remove y axis label\n```\n\n```{.r .cell-code}\nggsave(\"remadegraph.png\", width = 5, height = 5)\n```\n:::\n\n\n![](remadegraph.png){width=\"417\"}\n\nAfter adjusting the height and width of the final graph, the remade plot is pretty close to the original graph. The biggest differences that I could not code for is the font and removal of holidays.\n\n## Troubles/Issues\n\nWhen I was trying to recreate the graph, there was a lot of googling to figure out all the theme elements to adjust (particularly with [this website](https://ggplot2-book.org/polishing.html)), but my main issue was trying to get the correct data for percent change needed for the y axis. Google did not have that answer I was looking for since many of the solutions involved something along the line of [y = (..count..)/sum(..count..)](https://statisticsglobe.com/draw-categorical-variable-with-percentage-in-r) in ggplot. Eventually, I figured out how to manually code it correctly after determining exactly what was being compared on the graph. My notes from the Introduction to R class that I took last semester were very helpful for manually coding `plot1data`.\n",
    "supporting": [
      "visualization_exercise_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}